steps:
- script: |
    tox
  displayName: 'Linting & unit tests'

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testResultsFiles: '*-testresults.xml'
    testRunTitle: 'Linting & Unit tests'
    failTaskOnFailedTests: true
  displayName: 'Publish test results'

- task: UseDotNet@2
  displayName: 'Use .NET to generate coverage report'
  inputs:
    packageType: sdk
    version: 3.1.101

- script: |
    apt install libicu57

- task: PublishCodeCoverageResults@1
  displayName: 'Publish coverage report'
  condition: succeededOrFailed()
  inputs:
    codeCoverageTool: Cobertura
    summaryFileLocation: 'coverage.xml'
    reportDirectory: 'htmlcov'
    failIfCoverageEmpty: true
